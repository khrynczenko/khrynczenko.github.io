<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title> - What is [[nodiscard]] and why it is usefull.</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">

          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
              
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"
                  onload="renderMathInElement(document.body);"></script>
              
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;site.css">
          
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Krzysztof Hrynczenko&#x27;s blog</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;">Krzysztof Hrynczenko&#x27;s blog</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://khrynczenko.github.io/no-discard/#what-is-nodiscard" class="toc-link">What is [[nodiscard]]?</a>
                    
                </li>
                
                <li>
                    <a href="https://khrynczenko.github.io/no-discard/#what-does-nodiscard-do" class="toc-link">What does [[nodiscard]] do?</a>
                    
                </li>
                
                <li>
                    <a href="https://khrynczenko.github.io/no-discard/#why-is-it-useful" class="toc-link">Why is it useful?</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;no-discard&#x2F;">What is [[nodiscard]] and why it is usefull.</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2020-05-27</span>
            
        </div>
    </header>

    <div class="post-content">
      <h1 id="what-is-nodiscard">What is <code>[[nodiscard]]</code>?</h1>
<p><code>[[nodiscard]]</code> is another attribute that has been added into C++ in the
C++17 version. If you don't know what <em>attributes</em> are you can find the details on the <a href="https://en.cppreference.com/w/cpp/language/attributes/nodiscard">reference page</a> but putting it simply they are things that
you can annotate types, functions and other things with and thus provide
some additional information to the compiler.</p>
<p><code>[[nodiscard]]</code> particularly can be applied in function, enum and
class declarations. So for example they can appear in the following way.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class</span><span style="color:#eff1f5;"> [[</span><span style="color:#ebcb8b;">nodiscard</span><span style="color:#eff1f5;">]] NoDiscardClass {</span><span style="color:#eff1f5;">
}</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">enum class</span><span style="color:#c0c5ce;"> [[nodiscard]] NoDiscardEnum {</span><span style="color:#c0c5ce;">
};</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
[[nodiscard]] </span><span style="color:#b48ead;">bool </span><span style="color:#bf616a;">is_discarded</span><span style="color:#c0c5ce;">() {</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span></pre><h1 id="what-does-nodiscard-do">What does <code>[[nodiscard]]</code> do?</h1>
<p>In case where it is used with a <em>class</em> or <em>enum</em> it indicates that when value of such type is returned from any function and not used in any way
a compiler should emit warning to the user. Below is an example of such
situation.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">class</span><span style="color:#eff1f5;"> [[</span><span style="color:#ebcb8b;">nodiscard</span><span style="color:#eff1f5;">]] NoDiscardClass {</span><span style="color:#eff1f5;">
}</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
NoDiscardClass </span><span style="color:#8fa1b3;">do_something</span><span style="color:#c0c5ce;">() {</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> NoDiscardClass{};</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
{</span><span style="color:#c0c5ce;">
	</span><span style="color:#bf616a;">do_something</span><span style="color:#c0c5ce;">();</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>So we do not handle value given by <code>do_something</code> but because we
annotated <code>NoDiscardClass</code> with <code>[[nodiscard]]</code> compiler (in this case MSVC)
emits following warning.</p>
<p><strong><code>warning C4834:  discarding return value of function with 'nodiscard' attribute</code></strong></p>
<p>If we would remove <code>[[nodiscard]]</code> this code would compile without any warnings.</p>
<p>In case when <code>[[nodiscard]]</code> is used with function then it doesn't
matter whether the type returned by it is annotated or not, warning will be
emitted nonetheless. So again showing it in an example.</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">[[nodiscard]] </span><span style="color:#b48ead;">bool </span><span style="color:#bf616a;">is_positive</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> number) {</span><span style="color:#c0c5ce;">
	 </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> number &gt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">()</span><span style="color:#c0c5ce;">
{</span><span style="color:#c0c5ce;">
	</span><span style="color:#bf616a;">is_positive</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">10</span><span style="color:#c0c5ce;">);</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>Again this code when compiled issues warning that looks exactly the same as
the previous one.</p>
<h1 id="why-is-it-useful">Why is it useful?</h1>
<p>Being programmers and having to remember so many things when writing code
it is easy to forget things. One of such things is to handle returned values.
I think that when function returns something it is not for no reason and it
is our job to do something with that value whether it is result of some
calculation or just error indicator.</p>
<p>Why would we call a function that returns a value and then do nothing with
it? This would probably mean that the function does something more like modifies a state or performs <em>IO</em>.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">filesystem</span><span style="color:#c0c5ce;">&gt;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
[[nodiscard]] </span><span style="color:#b48ead;">bool </span><span style="color:#bf616a;">is_positive</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> number) {</span><span style="color:#c0c5ce;">
	 </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> number &gt; </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">bool </span><span style="color:#8fa1b3;">log_sqrt_to_file</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const</span><span style="color:#c0c5ce;"> std::filesystem::path&amp; </span><span style="color:#bf616a;">filename</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">) {</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(!</span><span style="color:#bf616a;">is_positive</span><span style="color:#c0c5ce;">(number)) {</span><span style="color:#c0c5ce;">
		</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
	}</span><span style="color:#c0c5ce;">
    </span><span style="color:#65737e;">// logging part</span><span style="color:#65737e;">
</span><span style="color:#c0c5ce;">}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">argc</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">* </span><span style="color:#bf616a;">argv</span><span style="color:#c0c5ce;">[])</span><span style="color:#c0c5ce;">
{</span><span style="color:#c0c5ce;">
	</span><span style="color:#bf616a;">log_sqrt_to_file</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">log.txt</span><span style="color:#c0c5ce;">&quot;, argc);</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>Here I could imagine if we do not care whether logging with <code>log_sqrt_to_file</code> succeeded we don't need to handle returned value. If we would apply
<code>[[nodiscard]]</code> to the <code>log_sqrt_to_file</code> we would get that pesky warning
that we don't want in this case because we discard the value purposefully.
So how about adding [[nodiscard]] and just assigning it to some variable.</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">[[nodiscard] </span><span style="color:#b48ead;">bool </span><span style="color:#bf616a;">log_sqrt_to_file</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">const</span><span style="color:#c0c5ce;"> std::filesystem::path&amp; filename, </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> number) {</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(!</span><span style="color:#bf616a;">is_positive</span><span style="color:#c0c5ce;">(number)) {</span><span style="color:#c0c5ce;">
		</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
	}</span><span style="color:#c0c5ce;">
    </span><span style="color:#65737e;">// logging part</span><span style="color:#65737e;">
</span><span style="color:#c0c5ce;">}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">main</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> argc, </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">* argv[])</span><span style="color:#c0c5ce;">
{</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">bool</span><span style="color:#c0c5ce;"> _ = </span><span style="color:#bf616a;">log_sqrt_to_file</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">log.txt</span><span style="color:#c0c5ce;">&quot;, argc);</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>Unfortunately this will give as another warning.<br />
<code>warning C4189:  '_': local variable is initialized but not referenced</code>
Fortunately there is a way
around it an that is coincidentally another attribute i.e. [[maybe_unused]].
So we can just add it to the assigned variable and voila.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">argc</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">* </span><span style="color:#bf616a;">argv</span><span style="color:#c0c5ce;">[])</span><span style="color:#c0c5ce;">
{</span><span style="color:#c0c5ce;">
	[[maybe_unused]] </span><span style="color:#b48ead;">bool</span><span style="color:#c0c5ce;"> _ = </span><span style="color:#bf616a;">log_sqrt_to_file</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">log.txt</span><span style="color:#c0c5ce;">&quot;, argc);</span><span style="color:#c0c5ce;">
	</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
}</span><span style="color:#c0c5ce;">
</span></pre>
<p>So we get the good of <code>[[nodiscard]]</code> and still have the flexibility.</p>
<p>Im am not so sure about usefulness of <code>[[nodiscard]]</code> on <em>classes</em> and <em>enums</em>
except when they the indicate errors maybe.</p>
<p>I hope that this is useful overview of the <code>[[nodiscard]]</code> attribute and
I encourage you to think about using it in your own projects.</p>
<hr />
<p><em>Here comes my opinion so please bare with me...</em><br />
So I know there are cases
where we do not care about returned value but I believe that those
are few and far between and because of that we should apply <code>[[nodiscard]]</code> to
all functions except when we have a good reason not to. I would love to have
it by default but yeah we are in C++ world and we have to consider things like
backward compatibility and impacting existing code-bases.</p>
<p>Albeit I have beef with attributes in general is that it makes C++ code which is already very verbose even more cluttered with keywords. We already have
<code>consextpr</code>, <code>noexcept</code>, <code>inline</code>, <code>virtual</code>, <code>override</code> etc. Things are
are getting out of hand. Nowadays declarations are starting to look like monsters. I pity those who start their journey with C++ and have to look
at modern C++. There is just so much cognitive overhead when compare to <code>C with classes</code> or other languages.</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">template</span><span style="color:#c0c5ce;">&lt;</span><span style="color:#b48ead;">typename</span><span style="color:#c0c5ce;"> T, </span><span style="color:#b48ead;">typename </span><span style="color:#c0c5ce;">= std::enable_if&lt;std::is_arithmetic&lt;T&gt;::value&gt;&gt;</span><span style="color:#c0c5ce;">
[[nodiscard]] </span><span style="color:#b48ead;">constexpr bool </span><span style="color:#bf616a;">is_positive</span><span style="color:#c0c5ce;">(T&amp;&amp; number) noexcept;</span><span style="color:#c0c5ce;">
</span></pre>
<p>So I stared learning when C++11 was becoming a thing and learned C++ gradually.
I fear that nowadays newcomers can become overwhelmed and hence discouraged
to use C++.</p>
<p>Yeah we get all these goodies in Modern C++ but there is some cost. I think getting into the language for newcomers might be becoming harder and harder.</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;tags&#x2F;c&#x2F;">#C++</a>
                    
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;tags&#x2F;c-17&#x2F;">#C++17</a>
                    
                        <a href="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;tags&#x2F;c-attributes&#x2F;">#C++ attributes</a>
                    
                </div>
            
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;khrynczenko.github.io&#x2F;even.js" ></script>
      
    </body>

</html>
